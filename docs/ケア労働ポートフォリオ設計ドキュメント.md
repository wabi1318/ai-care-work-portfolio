## ケア労働ポートフォリオ設計ドキュメント（実装構造に基づく修正版）

### 1. 出力項目の構成

#### ヘッダー

- users テーブルから取得：氏名（`name`）、メールアドレス（`email`）
- PDFダウンロードボタン

#### 専門的概要（Professional Summary）

- 活動量（例：care_activities からの件数、合計所要時間）
- 主要スキル3つ（skills + 集計値から頻出スキル）
- LLM生成の Unique Selling Point（USP）

#### コアスキル一覧（強みの見える化）

- skills テーブルから取得
- activity_skills 経由で集計（頻度・impact・duration など）
- 発揮傾向スコア（まれに見られる～強く見られる）
- レベルアイコンやバッジ表示

#### スキル詳細

- 各スキルに紐づく care_activities の代表エピソード
- 回数・平均時間・影響度（impact）などの数値

#### 職務経歴書向け文例（Bullet Statements）

- LLMで activity_skills + care_activities をもとに STAR 形式で生成

#### ビジネス転換マッピング

- skills テーブルに biz_equivalent を追加予定（例：「危機対応力 → リスクマネジメント」）

---

### 2. LLM分析とコード実装の切り分け

| 処理               | LLMで実施                              | コードで実装                      |
| ------------------ | -------------------------------------- | --------------------------------- |
| スキルタグ付け     | care_activities.content を多ラベル分類 | batch 処理 + activity_skills 作成 |
| 熟練度スコアリング | impact, difficulty を自然言語から分類  | SQL集計＋基準値マッピング         |
| STAR文章生成       | gpt-4o に activity_skills を渡して生成 | キャッシュと重複除去              |
| PDF出力            | -                                      | @react-pdf/renderer               |
| グラフ描画         | -                                      | Recharts（Next.js）               |

---

### 3. 実装方法（フローとインフラ）

```mermaid
graph TD
A(ユーザ入力) --> B[care_activities テーブル]
B --> C[LLMスキル分類処理 → activity_skills に格納]
C --> D[skills テーブルでスキル定義参照]
D --> E[日次/ユーザ別スキル集計ビュー]
E --> F[ポートフォリオAPI]
F --> G[Next.js UI (ポートフォリオ画面)]
F --> H[PDF出力機能（server action）]
```

#### 主なテーブル構成（Drizzle）

- `users`: ユーザー情報
- `care_activities`: 活動記録（content, timestamp, userId）
- `activity_skills`: スキル付与（activityId, skillId, impact, duration, difficulty）
- `skills`: スキル定義（name_ja, name_en, biz_equivalent など）
