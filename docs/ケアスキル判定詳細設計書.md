# ケア労働スキル評価アプリ 詳細設計書（入力・API・LLM設計特化）

## 1. アプリケーション目的

日々のケア労働（育児・介護・家事など）の経験を、職場で活かせるスキルとして可視化・言語化する。ユーザーの入力内容を元に、LLM（GPT-4o-mini）を活用してスキルカテゴリ抽出・職務経歴書風の表現を自動生成する。

---

## 2. ユーザー入力設計

### 2.1 入力UI

ユーザーが日々の活動を自然に記録できるよう、次の項目を入力フォームで提供。

| フィールド名     | 型     | 必須 | 入力形式例                       |
| ---------------- | ------ | ---- | -------------------------------- |
| date             | Date   | ◯    | カレンダー選択または自動入力     |
| activity_content | String | ◯    | 例：「子どもを保育園に送迎した」 |
| duration         | Number | ◯    | 単位：分。例：90                 |
| problem          | String | ×    | 自由記述（任意）                 |
| emotion          | String | ×    | プルダウン（喜/怒/悲/平静など）  |
| result           | String | ×    | 成果や家族の反応（任意）         |

### 2.2 入力補助設計

- **プレースホルダー例**：例文や入力例を表示し、初心者でも記録しやすく。
- **テンプレート選択**：頻出する活動例（保育園送迎、買い物、服薬管理など）を選択して補完可能。
- **入力検証**：activity_content の文字数制限（例：10文字以上）など簡易バリデーション。

---

---

## 3. API 設計

### 3.1 POST `/api/activities`

ユーザーが活動記録を送信し、LLM分析 → DB保存までを担う統合エンドポイント。

#### リクエスト

```json
{
  "date": "2025-05-03",
  "activity_content": "子どもを保育園に送迎した",
  "duration": 90,
  "problem": "朝起きられず時間が押した",
  "emotion": "焦ったが冷静に対応",
  "result": "時間通り送り届けた"
}
```

#### 処理フロー

1. バリデーション
2. LLMへプロンプトを構築し送信（後述）
3. LLMの返答（スキルカテゴリ+職務経歴書風文+熟練度）を解析
4. `care_activities` テーブルに保存（Supabase）
5. `skills` テーブルと中間テーブル `activity_skills` によりスキル＋熟練度を保存

#### レスポンス

```json
{
  "skills": [
    { "name": "マルチタスク管理能力", "proficiency": "高い" },
    { "name": "問題解決能力", "proficiency": "中程度" }
  ],
  "resume_summary": [
    "家庭内のスケジュールを全体的に管理し、複数のケア業務を効率的に実行",
    "時間変更への冷静な対応と子どもとの円滑なコミュニケーションを実施"
  ]
}
```

### 3.2 GET `/api/portfolio`

- ユーザーの全活動を通じて蓄積されたスキルを、熟練度とともに一覧表示。

---

## ４. データベース設計

### 4.1 `user`テーブル

| カラム名   | 型        | 説明                     |
| ---------- | --------- | ------------------------ |
| id         | INTEGER   | 主キー、自動生成         |
| name       | TEXT      | ユーザー名               |
| email      | TEXT      | メールアドレス           |
| created_at | TIMESTAMP | レコード作成日時（自動） |
| updated_at | TIMESTAMP | レコード更新日時（自動） |

### 5.1 `care_activities` テーブル

| カラム名         | 型        | 説明                                     |
| ---------------- | --------- | ---------------------------------------- |
| id               | INTEGER   | 主キー、自動生成                         |
| user_id          | INTEGER   | ユーザーID（外部キー）                   |
| date             | DATE      | 活動日                                   |
| activity_content | TEXT      | 活動内容の詳細                           |
| duration         | INTEGER   | 活動にかかった時間（分）                 |
| problem          | TEXT      | 発生した課題（任意）                     |
| emotion          | TEXT      | 感情・気分（任意）                       |
| result           | TEXT      | 結果や家族の反応（任意）                 |
| resume_summary   | TEXT\[]   | 職務経歴書風に整形されたアピール文の配列 |
| created_at       | TIMESTAMP | レコード作成日時（自動）                 |
| updated_at       | TIMESTAMP | レコード更新日時（自動）                 |

### 5.2 `skills` テーブル

| カラム名   | 型        | 説明                   |
| ---------- | --------- | ---------------------- |
| id         | INTEGER   | 主キー、自動生成       |
| name       | TEXT      | スキル名（ユニーク）   |
| category   | TEXT      | スキルカテゴリ（任意） |
| created_at | TIMESTAMP | 作成日時               |

### 5.3 `activity_skills` 中間テーブル

| カラム名    | 型        | 説明                                     |
| ----------- | --------- | ---------------------------------------- |
| activity_id | INTEGER   | `care_activities.id` 外部キー            |
| skill_id    | INTEGER   | `skills.id` 外部キー                     |
| tendency    | TEXT      | 発揮傾向（強く見られる／少し見られる等） |
| relevance   | TEXT      | 関連性（高い／中程度／低い）             |
| reason      | TEXT      | 判断の理由                               |
| source      | TEXT      | LLM由来やユーザー手動追加などの区別      |
| created_at  | TIMESTAMP | 紐付け日時                               |

---

## 6. 今後の検討

- 出力フォーマットのJSON構造化強化（Zodなどでバリデーション）
- 複数日分のまとめ解析（バルクプロンプト）
- Claude等へのモデル切替検証
- スキルカテゴリ定義の階層化（サブカテゴリ導入）
- 熟練度の可視化UI（バッジ/スコア表示）

---

## 7. 備考

- スキル定義の階層化（例：時間管理 → タスク優先順位づけ、段取り力など）にも将来的に対応可能。
- 数値スコアではなくナラティブベースで信頼性を表現するため、出力は必ず理由付きとする。
- 出力フォーマットはフロントエンドでそのままUIに表示可能な形（JSONまたは構造化テキスト）を想定。
